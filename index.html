<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Employee Leave Manager</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://js.pusher.com/8.2/pusher.min.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="brand">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M7 3h10a2 2 0 0 1 2 2v14l-7-3-7 3V5a2 2 0 0 1 2-2z" stroke="currentColor" stroke-width="1.5" fill="none"/>
      </svg>
      <h1>Employee Leave Manager</h1>
    </div>
    <div class="header-actions">
      <div id="userInfo" class="auth-box"></div>
      
      
      
      <!-- Primary Action -->
      <div class="button-group">
        <button id="printCardBtn" class="primary">Print Card</button>
        <button id="gotoEmployeesBtn" class="ghost" title="Go to Employees">Employees</button>
        <button id="inboxBtn" class="ghost" title="Pending leave applications" style="position:relative;">
          Inbox <span id="inboxCount" class="badge">0</span>
        </button>
      </div>
      
      <!-- Data Management -->
      <div class="button-group secondary">
        <button id="exportBtn" class="ghost" title="Export data as JSON">Export JSON</button>
        <label class="import" title="Import data from JSON">
          <input id="importInput" type="file" accept="application/json" hidden />
          <span class="button ghost" id="importBtn">Import JSON</span>
        </label>
      </div>
      
      <!-- Cloud Sync -->
      <div class="cloud">
        <input id="cloudDocId" placeholder="cloud doc id" value="default" />
        <button id="cloudLoadBtn" class="ghost" title="Load from cloud">Load</button>
        <button id="cloudSaveBtn" class="ghost" title="Save to cloud">Save</button>
        <small id="cloudStatus" style="color:var(--muted)"></small>
      </div>
      
      <!-- Logout -->
      <div class="button-group secondary">
        <button id="logoutBtn" class="ghost">Logout</button>
      </div>
    </div>
  </header>

  <nav class="employee-tabs-nav" role="tablist" id="employeeTabsNav">
    <!-- Employee tabs will be populated by JS -->
  </nav>

  <nav class="year-tabs-nav" role="tablist">
    <button class="year-tab-nav active" data-year="2026" role="tab">2026</button>
  </nav>

  <nav class="tabs" role="tablist">
    <button class="tab active" data-tab="reports" role="tab">Leaves</button>
    <button class="tab" data-tab="employees" role="tab">Employees</button>
    <button class="tab" data-tab="calendar" role="tab">Calendar</button>
    <button class="tab" data-tab="settings" role="tab">Settings</button>
  </nav>

  <main>
    <!-- Employees -->
    <section id="tab-employees" class="tab-content" aria-labelledby="Employees">
      <div class="panel">
        <h2>Add / Edit Employee & User</h2>
        <form id="employeeForm" class="grid">
          <input type="hidden" id="employeeId" />
          <label>Name<input id="empName" required /></label>
          <label>Email (Sign-in)<input id="empEmail" type="email" /></label>
          <label>Job Title<input id="empTitle" /></label>
          <label>Department<input id="empDept" /></label>
          <label>Date Joined<input id="empJoined" type="date" /></label>
          <label>User Role
            <select id="empRole">
              <option value="EMPLOYEE">Employee</option>
              <option value="MANAGER">Manager</option>
              <option value="HR">HR</option>
            </select>
          </label>
          <div class="grid-span-2"></div>
          <h3 class="grid-span-2">Annual Leave Entitlement</h3>
          <label>Year
            <select id="empEntYear">
              <option value="2020">2020</option>
              <option value="2021">2021</option>
              <option value="2022">2022</option>
              <option value="2023">2023</option>
              <option value="2024" selected>2024</option>
              <option value="2025">2025</option>
              <option value="2026">2026</option>
              <option value="2027">2027</option>
              <option value="2028">2028</option>
              <option value="2029">2029</option>
              <option value="2030">2030</option>
            </select>
          </label>
          <label>Carry Forward (days)<input id="empCarry" type="number" step="0.5" min="0" /></label>
          <label>Current Year (days)<input id="empCurrent" type="number" step="0.5" min="0" /></label>
          <div class="form-actions grid-span-2">
            <button type="submit" class="primary">Save Employee & User</button>
            <button type="reset" id="employeeCancelBtn" class="ghost">Clear</button>
          </div>
        </form>
      </div>

      <div class="panel">
        <div class="panel-head">
          <h2>Employees & Users</h2>
          <div class="search-box"><input id="employeeSearch" placeholder="Search employees..." /></div>
        </div>
        <div class="table-wrap">
          <table id="employeesTable" class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Job Title</th>
                <th>Dept</th>
                <th>Date Joined</th>
                <th>Annual Entitlement</th>
                <th>Annual Taken</th>
                <th>Balance</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
    

    <!-- Reports -->
    <section id="tab-reports" class="tab-content active" aria-labelledby="Leaves">
      <div class="panel">
        <h2>Leave Card</h2>
        <div class="controls">
          <button id="refreshReport" class="ghost">Refresh</button>
          <button id="printBtn" class="primary">Print</button>
        </div>
        <div id="cardContainer" class="card-container">
          <!-- Generated content will render here -->
        </div>

        <div class="section-title">Manage Leaves (for selected employee & year)</div>
        <form id="reportLeaveForm" class="grid">
          <input type="hidden" id="reportLeaveId" />
          <label>Type
            <select id="reportLeaveType" required>
              <option value="ANNUAL">Annual Leave</option>
              <option value="SL">Sick Leave (SL)</option>
              <option value="HL">Hospitalisation (HL)</option>
              <option value="TC">Time Chit (TC)</option>
              <option value="MATERNITY">Maternity</option>
              <option value="PATERNITY">Paternity</option>
              <option value="MARRIAGE">Marriage</option>
              <option value="COMPASSIONATE">Compassionate</option>
            </select>
          </label>
          <label>Application Date<input id="reportLeaveApplied" type="date" /></label>
          <label>From<input id="reportLeaveFrom" type="date" required /></label>
          <label>To<input id="reportLeaveTo" type="date" required /></label>
          <label>Working Days (auto)<input id="reportLeaveDays" type="number" step="0.5" min="0" readonly /></label>
          <label class="grid-span-2">Reason<textarea id="reportLeaveReason" rows="2" placeholder="Optional"></textarea></label>
          <div class="form-actions grid-span-2">
            <button type="submit" class="primary">Apply Leave</button>
            <button type="reset" id="reportLeaveCancelBtn" class="ghost">Clear</button>
          </div>
        </form>

        <div class="table-wrap">
          <table id="reportLeavesTable" class="table">
            <thead>
              <tr>
                <th>Type</th>
                <th>Status</th>
                <th>Applied</th>
                <th>From</th>
                <th>To</th>
                <th>Days</th>
                <th>Reason</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Calendar -->
    <section id="tab-calendar" class="tab-content" aria-labelledby="Calendar">
      <div class="panel">
        <h2>Leave Calendar</h2>
        <div class="controls">
          <button id="calPrevMonth" class="ghost">← Previous</button>
          <span id="calCurrentMonth" style="font-weight: bold; min-width: 150px; text-align: center;">December 2025</span>
          <button id="calNextMonth" class="ghost">Next →</button>
          <label style="margin-left: 2rem;">Filter Employee
            <select id="calEmployeeFilter">
              <option value="">All Employees</option>
            </select>
          </label>
        </div>
        <div id="calendarContainer" style="margin-top: 1rem;">
          <!-- Calendar will be rendered here -->
        </div>
      </div>
    </section>

    <!-- Settings -->
    <section id="tab-settings" class="tab-content" aria-labelledby="Settings">
      <div class="panel">
        <h2>User</h2>
        <form id="userForm" class="grid">
          <label>Your Name<input id="currentUserName" placeholder="e.g., Alex" /></label>
          <label>Your Role
            <select id="currentUserRole">
              <option value="EMPLOYEE">Employee</option>
              <option value="MANAGER">Manager</option>
              <option value="HR">HR</option>
            </select>
          </label>
          <div class="form-actions grid-span-2">
            <button type="submit" class="primary">Save User</button>
          </div>
        </form>
      </div>

      <div class="panel">
        <h2>Data Maintenance</h2>
        <div class="controls">
          <button id="resetCarryForwardBtn" class="ghost" title="Fix carry-forward values to correct amounts (max 5 days per year)">Reset Carry-Forward Values</button>
        </div>
      </div>

      <div class="panel">
        <h2>Holidays</h2>
        <div class="controls">
          <label>Year
            <select id="holYear">
              <option value="2020">2020</option>
              <option value="2021">2021</option>
              <option value="2022">2022</option>
              <option value="2023">2023</option>
              <option value="2024">2024</option>
              <option value="2025" selected>2025</option>
              <option value="2026">2026</option>
              <option value="2027">2027</option>
              <option value="2028">2028</option>
              <option value="2029">2029</option>
              <option value="2030">2030</option>
            </select>
          </label>
          <label>Country Code<input id="holCountry" placeholder="e.g., SG, US, GB" maxlength="2" /></label>
          <button id="fetchHolidays" class="ghost">Fetch Public Holidays</button>
          <button id="loadMY2026" class="ghost" title="Load Malaysia 2026 (National + Selangor)">Load MY 2026 (National + Selangor)</button>
          <button id="loadMY2025" class="ghost" title="Load Malaysia 2025 (National + Selangor)">Load MY 2025 (National + Selangor)</button>
          <button id="loadMY2027" class="ghost" title="Load Malaysia 2027 (National + Selangor)">Load MY 2027 (National + Selangor)</button>
          <button id="holClearBtn" class="danger" title="Remove ALL holidays from all years">Clear All Holidays</button>
          <button id="showCountriesBtn" class="ghost" title="Show list of supported countries">Show Available Countries</button>
          <label>Add Date<input id="holAddDate" type="date" /></label>
          <button id="holAddBtn" class="ghost">Add</button>
        </div>
        <div id="countriesListContainer" style="display:none; margin-top: 1rem;">
          <p><strong>Supported countries (updated Nov 2024):</strong></p>
          <p id="countriesList" style="font-size: 0.9em; line-height: 1.6;"></p>
        </div>
        <div class="table-wrap">
          <table class="table" id="holidaysTable">
            <thead><tr><th>Date</th><th>Name</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="panel">
        <h2>Audit Trail</h2>
        <div class="controls">
          <label>Filter by Action
            <select id="auditActionFilter">
              <option value="">All</option>
              <option value="CREATE">Create</option>
              <option value="UPDATE">Update</option>
              <option value="DELETE">Delete</option>
              <option value="APPROVE">Approve</option>
              <option value="REJECT">Reject</option>
            </select>
          </label>
          <label>Filter by Entity Type
            <select id="auditEntityFilter">
              <option value="">All</option>
              <option value="LEAVE">Leave</option>
              <option value="EMPLOYEE">Employee</option>
              <option value="USER">User</option>
              <option value="ENTITLEMENT">Entitlement</option>
            </select>
          </label>
          <button id="loadAuditLogsBtn" class="primary">Load Audit Trail</button>
        </div>
        <div id="auditLogsContainer" class="table-wrap" style="margin-top: 1rem;">
          <table class="table" id="auditLogsTable">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>User</th>
                <th>Action</th>
                <th>Entity</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>Employee Leave Manager • Local-only demo. Use Export for backups.</small>
  </footer>

  <!-- Simple inbox dropdown container -->
  <div id="inboxDropdown" class="panel" style="position:fixed; right:16px; top:58px; width:420px; max-height:60vh; overflow:auto; display:none; z-index:20;"></div>

  <script src="app.js"></script>
</body>
</html>
